@model IEnumerable<MusicPlayerWeb.Models.Album>

@{
    ViewData["Title"] = "Albums";
}

<style>
    /* --- HEADER AREA --- */
    .playlist-header-area {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }

    /* Search Bar Custom */
    .search-input-group {
        position: relative;
        width: 300px;
    }

        .search-input-group input {
            background-color: #2A3550;
            border: 1px solid #3E4C6E;
            color: white;
            border-radius: 20px;
            padding: 8px 15px 8px 35px;
            width: 100%;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

            .search-input-group input:focus {
                border-color: var(--accent-color);
            }

    .search-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #6F7A95;
        font-size: 14px;
    }

    /* --- ALBUM CARD (Sama seperti Playlist Card) --- */
    .playlist-card {
        background-color: #1B2338;
        padding: 16px;
        border-radius: 8px;
        transition: background-color 0.3s;
        cursor: pointer;
        display: block;
        text-decoration: none;
        height: 100%;
    }

        .playlist-card:hover {
            background-color: #2A3550;
        }

    /* --- COVER IMAGE (KOTAK) --- */
    .cover-container {
        width: 100%;
        aspect-ratio: 1 / 1; /* Kotak Sempurna */
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 16px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        position: relative;
        background-color: #333;
    }

    /* Single Image */
    .cover-single {
        width: 100%;
        height: 100%;
    }

        .cover-single img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    /* Placeholder */
    .cover-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #2A3550;
        color: #6F7A95;
    }

        .cover-placeholder svg {
            width: 50%;
            height: 50%;
            fill: currentColor;
        }

    /* Text */
    .pl-title {
        color: white;
        font-weight: 700;
        font-size: 16px;
        margin-bottom: 4px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .pl-desc {
        color: #AEB7D3;
        font-size: 13px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>

<div class="playlist-header-area">
    <div class="search-input-group">
        <span class="search-icon">🔍</span>
        <input type="text" id="albumSearch" placeholder="Search albums..."
               onkeydown="if(event.key === 'Enter') searchAlbums(this.value)">
    </div>
</div>

<div class="row row-cols-2 row-cols-md-4 row-cols-lg-5 g-4">
    @foreach (var album in Model)
    {
        // Ambil lagu pertama untuk cover album
        var firstSong = album.Songs.FirstOrDefault();
        var imgUrl = firstSong != null ? $"/Music/GetAlbumArt/{firstSong.Id}" : "";

        <div class="col">
            <a href="/Music/AlbumDetails/@album.Id" class="playlist-card ajax-link">

                <div class="cover-container" style="position: relative; background-color: #2A3550;">

                    <div class="cover-placeholder"
                         style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1;">
                        <svg viewBox="0 0 24 24" style="width: 50%; height: 50%; fill: #6F7A95;">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-5.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z" />
                        </svg>
                    </div>

                    @if (!string.IsNullOrEmpty(imgUrl))
                    {
                        <img src="@imgUrl"
                             style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 2;"
                             onerror="this.style.display='none';" />
                    }
                </div>

                <div class="pl-title">@album.Title</div>
                <div class="pl-desc">@album.Artist.Name • @album.Songs.GroupBy(s => s.Title).Count() songs</div>
            </a>
        </div>
    }
</div>

<script>
    function searchAlbums(query) {
        // Encode query agar aman di URL
        const url = '/Music/Albums?search=' + encodeURIComponent(query);

        // Gunakan loadPage dari _Layout jika tersedia (untuk SPA/AJAX)
        if (typeof loadPage === 'function') {
            loadPage(url);
        } else {
            window.location.href = url;
        }
    }
</script>